/*
 * clock.c
 *
 *  Created on: 09/04/2021
 *      Author: baioc
 */

/*******************************************************************************
 * Includes
 ******************************************************************************/

#include "kbd.h"

#include "interrupts.h"
#include "cpu.h"

extern void kbd_interrupt_handler(void);

/*******************************************************************************
 * Macros
 ******************************************************************************/

#define PS2_CMND_PORT 0x64
#define PS2_DATA_PORT 0x60

/*******************************************************************************
 * Types
 ******************************************************************************/

/*******************************************************************************
 * Internal function declaration
 ******************************************************************************/

/*******************************************************************************
 * Variables
 ******************************************************************************/

/*******************************************************************************
 * Public function
 ******************************************************************************/

void kbd_init(void)
{
  set_interrupt_handler(INTR_VECTOR_OFFSET + 1, kbd_interrupt_handler, PL_USER);
  mask_irq(1, false);
}

// https://wiki.osdev.org/PS/2_Keyboard

// str is null-terminated
void keyboard_data(char *str)
{
  (void)str;
}

void kbd_leds(unsigned char leds)
{
  (void)leds;
}

#include "stdio.h"
void kbd_interrupt(void)
{
  printf(" --[[ %x ]]-- ", inb(PS2_DATA_PORT));
  acknowledge_interrupt(1);
}

/*******************************************************************************
 * Internal function
 ******************************************************************************/
